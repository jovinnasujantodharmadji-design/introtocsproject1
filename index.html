<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="overlay" onclick="closeNav()"></div>
    
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html" style="color: #6ab3f8;">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="diet.html">ğŸ Diet Tracker</a>
        <a href="walking.html">ğŸ‘£ Walking</a>
        <a href="water.html">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="stairs.html">ğŸªœ Stairs Tracker</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
        <a href="exercise.html">ğŸƒ Exercise</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container" style="margin-top: 0;">
        <h2>ğŸ‘‹ Welcome Back</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ‘£ Steps</h3>
                <div class="stat-number" id="display-steps">0</div>
                <small>steps today</small>
            </div>
            <div class="stat-card">
                <h3>ğŸ’§ Water</h3>
                <div class="stat-number" id="display-water">0</div>
                <small>mL today</small>
            </div>
            <div class="stat-card">
                <h3>ğŸ˜´ Sleep</h3>
                <div class="stat-number" id="display-sleep">--</div>
                <small>hours</small>
            </div>
            <div class="stat-card">
                <h3>âš–ï¸ BMI</h3>
                <div class="stat-number" id="display-bmi">--</div>
                <span id="bmi-text" style="font-size:0.8em; color:#777;"></span>
            </div>
        </div>

        <div class="card" id="diet-summary-card">
            <h3>ğŸ Diet Snapshot</h3>
            <p style="text-align:center; color:#777;">Loading diet data...</p>
        </div>

        <div class="card">
            <h3>ğŸ“Š 7-Day Water Intake</h3>
            <canvas id="waterChart"></canvas>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="clearAllData()" class="danger-btn small">Reset All Data</button>
        </div>
    </div>

    <script>
        function openNav() { document.getElementById("mySidenav").style.width = "250px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; document.getElementById("overlay").style.display = "none"; }

        window.onload = function() {
            // è®€å–æ­¥æ•¸
            const steps = localStorage.getItem('w_steps') || 0;
            document.getElementById('display-steps').textContent = Number(steps).toLocaleString();

            // è®€å–æ°´
            const water = localStorage.getItem('totalWater') || 0;
            document.getElementById('display-water').textContent = water;

            // è®€å–ç¡çœ 
            const sleepData = localStorage.getItem('sleepRecords');
            if (sleepData) {
                const records = JSON.parse(sleepData);
                if (records.length > 0) document.getElementById('display-sleep').textContent = records[0].hours;
            }

            // è®€å– BMI
            const h = localStorage.getItem('profileHeight');
            const w = localStorage.getItem('profileWeight');
            if(h && w) {
                const heightInMeters = h / 100;
                const bmi = (w / (heightInMeters * heightInMeters)).toFixed(1);
                document.getElementById('display-bmi').textContent = bmi;
            }

            // è®€å– Diet æ‘˜è¦
            const today = new Date().toISOString().slice(0, 10);
            const dietSummary = JSON.parse(localStorage.getItem(`dietSummary_${today}`) || '{}');
            const tdee = localStorage.getItem('tdee') || 2000;
            const dietCard = document.getElementById('diet-summary-card');

            if (dietSummary.calories) {
                const pct = Math.min(100, (dietSummary.calories / tdee) * 100);
                const color = dietSummary.calories > tdee ? '#e74c3c' : '#2ecc71';
                dietCard.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <span><strong>${dietSummary.calories}</strong> / ${tdee} kcal</span>
                        <small style="color:${color}">${(dietSummary.calories > tdee) ? 'Over' : 'Good'}</small>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${pct}%; background-color: ${color};"></div>
                    </div>
                    <div style="font-size:0.85em; color:#666; margin-top:10px; display:flex; justify-content:space-around;">
                        <span>P: ${dietSummary.protein}g</span>
                        <span>F: ${dietSummary.fat}g</span>
                        <span>C: ${dietSummary.carbs}g</span>
                    </div>
                    <div style="text-align:center; margin-top:10px;">
                        <button class="primary-btn small" onclick="location.href='diet.html'">View Details</button>
                    </div>
                `;
            } else {
                dietCard.innerHTML = `
                    <p style="text-align:center; color:#888;">No food logged today.</p>
                    <div style="text-align:center;">
                        <button class="primary-btn small" onclick="location.href='diet.html'">Log Food</button>
                    </div>
                `;
            }

            renderChart();
        };

        function renderChart() {
            const records = JSON.parse(localStorage.getItem('waterRecords') || '[]');
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toLocaleDateString();
                labels.push(`${d.getMonth() + 1}/${d.getDate()}`);
                const dayTotal = records.filter(r => r.date === dateStr).reduce((sum, r) => sum + r.amount, 0);
                data.push(dayTotal);
            }

            const ctx = document.getElementById('waterChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{ label: 'Water (mL)', data: data, backgroundColor: '#4a90e2', borderRadius: 4 }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        }

        function clearAllData() {
            if(confirm('Warning: This will delete ALL history from all trackers. Continue?')) { 
                localStorage.clear(); 
                location.reload(); 
            }
        }
    </script>
</body>
</html>
